#generated by ansible

tunnel: {{ argo_hostname }}-{{ device }}
uuid: {{ argo_uuid }}
credentials-file: {{ config_dir }}/.credentials/{{ argo_uuid }}.json
logfile: {{ log_dir }}/cloudflared.log
autoupdate-freq: {{ autoupdate_freq }}

# ingress rules to provide to config file
ingress:
  {% for service, details in ingress_rules.items() %}
  - hostname: "services-{{ device }}-{{ argo_hostname }}.cstunnel.xyz"
    path: "(/{{ details.paths|join('|') }})"
    service: "{{ details.protocol }}://localhost:{{ details.port }}"
  {% endfor %}
  - hostname: "ssh-{{ device }}-{{ argo_hostname }}.cstunnel.xyz"
    service: "ssh://localhost:{{ ssh_port }}"
  #catch all rule
  - service: "http_status:404"
