#generated by ansible

tunnel: {{ argo_hostname }}-{{ device }}
uuid: {{ argo_uuid }}
credentials-file: {{ config_dir }}/.credentials/{{ argo_uuid }}.json
logfile: {{ log_dir }}/cloudflared.log
autoupdate-freq: {{ autoupdate_freq }}

# ingress rules to provide to config file
ingress:
  {% for service, details in ingress_rules.items() %}
  {% if details.protocol not in ['http', 'https'] %}
  - hostname: "{{ service }}-{{ device }}-{{ argo_hostname }}.cstunnel.xyz"
    service: "{{ details.protocol }}://localhost:{{ details.port }}"
  {% else %}
  - hostname: "ssh-{{ device }}-{{ argo_hostname }}.cstunnel.xyz"
    path: "/{{ service }}"
    service: "{{ details.protocol }}://localhost:{{ details.port }}"
  {% endif %}
  {% endfor %}
  #catch all rule
  - service: "http_status:404"
